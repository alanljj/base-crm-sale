<?xml version="1.0"?>
<openerp>
    <data>         
        <!-- CRM Lead Form View  -->
        <record model="ir.ui.view" id="crm_case_form_view_leads_inherit">
            <field name="name">CRM - Leads Form - Inherit</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_leads"/>
            <field name="arch" type="xml">
                <button string="Convert to Opportunity" position="after">
                    <button name="next_stage" string="Next Stage" type="object"
                        help="Go to Next Stage" class="oe_highlight"
                        attrs="{'invisible': True}"
                    />                                           
                </button>            
                <field name="priority" position="after">
                    <field name="stage_deadline"
                        attrs="{'invisible': [('stage_deadline', '=', False)]}"
                    />
                </field>
            </field>
        </record>    
        <!-- CRM Opportunity Form View -->
        <record model="ir.ui.view" id="crm_case_form_view_oppor_inheritt">
            <field name="name">CRM - Opportunities Form - Inherit</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
            <field name="arch" type="xml">
                <button name="case_mark_won" string="Mark Won" position="before">
                    <field name="stage_probability" invisible="1"/>
                    <button name="next_stage" string="Next Stage" type="object"
                        help="Go to Next Stage" class="oe_highlight"
                        attrs="{'invisible': ['|', ('stage_probability', '=', 100.0), ('stage_probability', '=', 0.0)]}"
                    />
                    <button name="back_stage" string="Back Stage" type="object"
                        help="Jump to back Stage"
                        attrs="{'invisible': ['|', ('stage_probability', '=', 100.0), ('stage_probability', '=', 0.0)]}"
                    />                                                            
                </button>
                <button name="case_mark_lost" position="after">
                    <button name="reset_stage" string="Reset Stages" type="object"
                        help="Go to Default Stage"
                    />                    
                </button>
                <field name="stage_id" position="replace">
                    <field name="stage_id"
                        widget="statusbar" options="{'fold_field': 'fold'}"
                        domain="['&amp;', ('section_ids', '=', section_id), '|', ('type', '=', type), ('type', '=', 'both')]"
                    />
                </field>            
                <field name="date_deadline" position="before">
                    <field name="stage_deadline"
                        attrs="{'invisible': [('stage_deadline', '=', False)]}"
                    />
                </field>
            </field>
        </record>  

        <!-- Opportunity Kanban View-->
        
        <record model="ir.ui.view" id="crm_case_kanban_view_leads_inherit">
            <field name="name">CRM - Leads Kanban Inherit</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
            <field name="arch" type="xml">
                <data>
                    <kanban default_group_by="stage_id" position="attributes">
                        <attribute name="edit">false</attribute>
                        <attribute name="quick_create">false</attribute>
                    </kanban>
                    <field name="date_deadline" position="before">
                        <field name="stage_deadline"/>
                    </field>                     
                    <xpath expr="/kanban/templates/t/div/div[2]/div/b" position="before">
                        <t t-if="(record.stage_deadline.raw_value and record.stage_deadline.raw_value lt (new Date())) or (record.date_deadline.raw_value and record.date_deadline.raw_value lt (new Date()))" t-set="red">oe_kanban_text_red</t>
                    </xpath>
                    <xpath expr="/kanban/templates/t/div/div[2]/div/b/field" position="replace">
                        <span t-attf-class="#{red || ''}"><field name="name"/></span>
                    </xpath>
                        <xpath expr="/kanban/templates/t/div/div[2]/div[3]/t[1]" position="replace"/>               
                </data>        
            </field>
        </record>                    
    </data>
</openerp>
